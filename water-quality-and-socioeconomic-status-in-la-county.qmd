---
title: "Water Quality and Socioeconomic Status In LA County"
format:
  html:
    code-fold: true
    code-summary: "Show the code"
editor: visual
---

# Does Household Income Have an Affect on Cardiovascular Health in LA County?

## Motivation

According to the CDC, cardiovascular-related diseases are the leading cause of death in America. Although there are a number of factors that influence cardiovascular diseases, I chose to study the relationship between median income of census tracts in Los Angeles County and the number of cardiovascular disease-related Emergency Department (ED) visits. In this research project, I will conduct a difference in means hypothesis test of two groups : Extremely Low Income and Above Moderate Income to see if there is a true difference in average cardiovascular disease-related Emergency Department (ED) visits.

## Data

CalEnviroScreen has recently celebrated their tenth anniversary since releasing their first version. The CalEnviroScreen data set used in this study aims to highlight which communities within California are the most impacted by pollution by using census tract data that includes socioeconomic and demographic information which can help further encapsulate the larger issue at hand : pollution burden. Both California EPA and OEHHA (Office of Environmental Health Hazard Assessment) have collaboratively formulated this Environmental Justice screening tool as a means to help visualize impacts of pollution burden while accumulating various demographic data accessible for readers.

-   Variables Explored:

    -   `PM2.5` - Annual mean PM 2.5 concentrations (micrograms per meter cubed)

    -   `education` - Percent of population over 25 with less than a high school education

    -   `linguistic_isolation` - Percent limited English speaking households

The second dataset used for this research project contains statistical information of median household income in LA County, which is then categorized into `ami categories` : Above Moderate Income, Moderate Income, Low Income, Very Low Income, and Extremely Low Income.

My game plan for analysis includes :

1.  Tidying both datasets
2.  Joining datasets by census tract
3.  Performing a linear regression
4.  Conducting a hypothesis test for a difference in means of population (extremely low income AMI census tracts vs above moderate income AMI census tracts)

## Methods

```{r message = FALSE , warning=FALSE}
# loading in needed libraries

library(tidyverse)
library(dplyr)
library(ggplot2)
library(stats)
library(lubridate)
library(janitor)
library(sf)
library(stargazer)
library(ggpmisc)
```

```{r message=FALSE}

# reading in the data 

income_la <- read_csv('./data/Median_Income_and_AMI_(census_tract).csv') %>% 
  rename('census_tract' = 'tract')

# reading in water la data

los_angeles <- read_csv('data/cal_enviro_4.csv') %>% 
  clean_names() %>% 
  filter(california_county == 'Los Angeles')


# joining in the two datasets

income_water_la <- left_join(los_angeles, income_la, by = "census_tract") %>% 
  na.omit()


# preliminary plotting
income_cardio_tox_ed <- lm(cardiovascular_disease ~ med_hh_income + tox_release +education, data = income_water_la)

income_cardio <- lm(cardiovascular_disease ~ med_hh_income, data = income_water_la)

summary(income_cardio)

summary(income_water_la$med_hh_income)



```

Linear equation:

$$
cardiovasculardisease = \hat{\beta}_1income + \hat{\beta}_2pm2.5 + \hat{\beta}_3education + \hat{\beta}_4linguisticisolation
$$

```{r}
ggplot(income_water_la, aes(x = med_hh_income, y = cardiovascular_disease, col = education))+
  geom_point()+
  stat_smooth(method = 'lm', col = 'red')+
  labs(x = 'Median Household Income (USD)',
       y = 'Cardiovascular Disease-related ED visits per 10,000 people',
       title = '     Median Income vs. Cardiovascular Disease')+
  theme_classic()+
  stat_poly_eq()
```

```{r}


ggplot(data = income_water_la, aes(x = med_hh_income))+
  geom_histogram(bins = 100, fill = 'lightblue')+
  labs(x = 'Median Household Income (USD)',
       y = 'Number of Census Tract Groups')


# estimate for 10,000 increase in median income # add more variables and see how r squared changes;
# holding all other variables constant 
cardio_cases <- income_cardio$coefficients["med_hh_income"]* 10000

print(cardio_cases)

# with a 10,000 increase in median income, cardiovascular disease rates go down by .26 per 10000 people. include formula before linear regression ; B1 is income, B2 is tox_release; B3 is education; hypothesis is whether B is 0 or not 
```

```         
```

```{r}
## hypothesis test construction
# summary statistics for cardiovascular disease related ed visits

cardio_stats <- income_water_la %>% 
  group_by(ami_category) %>% 
  summarise(mean = mean(cardiovascular_disease),
            sd = sd(cardiovascular_disease))


print(cardio_stats)
```

The `Extremely Low Income` AMI group has the most variance amongst AMI groups in this dataset.

Using the `stargazer` package, I will conduct three different linear models to determine which added variables positively affect the adjusted $$R^2$$ value.

```{r warning = FALSE}
# table of r squared values with different variables added 

m3 <- lm(cardiovascular_disease ~ med_hh_income + pm2_5 + education + linguistic_isolation, data = income_water_la)
m2 <- lm(cardiovascular_disease ~  pm2_5, data = income_water_la)
m1 <- lm(cardiovascular_disease ~ med_hh_income, data = income_water_la)


stargazer(m1, m2, m3, type="text",
          covariate.labels=c("Median Household Income","Particulate Matter Concentration","Percentage of Adults over 25 without a High School Diploma", "Percent Limited English Speaking Households"))
```

**Interpretation of stargazer table:**

[Output for first equation `m1`:]{.underline}

-   For every 1 unit increase in `Median Household Income`, the rate of cardiovascular disease related ED visits is expected to *decrease* by -0.0001 per 10,000.

    -   To put this in perspective, a 10,000 increase in `Median Household Income` is expected to decrease the rate of cardiovascular disease related ED visits by 1 per 10,000.

-   **R2** : 0.226 of all variability in the `cardiovascular_disease` output can be explained by `Median Household Income`.

[Output for second equation `m2`]{.underline} :

-   A one unit increase in annual particulate matter concentration `pm2_5` is expected to increase cardiovascular disease related ED visits by .254 per 10,000.

-   **R2** : .002 of all variability in the `cardiovascular_disease` output can be explained by `pm2_5`.

[Output for third equation `m3`]{.underline} :

-   

```         
```

$$H_{0}: \mu_{cardiodiseaseinExtrLowInc} - \mu_{cardiodiseaseinModInc}  = 0$$ $$H_{A}:  \mu_{cardiodiseaseinExtrLowInc} - \mu_{cardiodiseaseinModInc} \neq 0$$

$$SE = \sqrt{\frac{s_1^2}{n_1} + \frac{s^2_2}{n_2}}$$

```{r}

# computing a point estimate for both groups
mu_cardio_low <- income_water_la %>% 
  filter(ami_category == 'Extremely Low Income') %>% 
  summarize(mean(cardiovascular_disease))

mu_cardio_mod <- income_water_la %>% 
  filter(ami_category == 'Above Moderate Income') %>% 
  summarize(mean(cardiovascular_disease))


point_est_cardio <- as.numeric(mu_cardio_low - mu_cardio_mod) # will use for z-score 

print(point_est_cardio)


```

The point estimate value of `4.81` indicates that there is a difference between the two samples.

```{r}

# computing standard error

n1 <- income_water_la %>% 
  filter(ami_category == 'Extremely Low Income') %>% 
  count()

n2 <- income_water_la %>% 
  filter(ami_category == 'Above Moderate Income') %>% 
  count()

s1 <- income_water_la %>% 
  filter(ami_category == 'Extremely Low Income') %>% 
  summarize(sd(cardiovascular_disease, na.rm = TRUE))

s2<- income_water_la %>% 
  filter(ami_category == 'Above Moderate Income') %>% 
  summarize(sd(cardiovascular_disease, na.rm = TRUE))


# computing standard error

standard_error <-as.numeric(sqrt(s1^2/n1 + s2^2/n2))


# computing z-score
z <- (point_est_cardio - 0)/standard_error

print(z)


# z-score is around 8 standard deviations away from the mean  of 0 ?

```

The z-score of `8.19` indicates that the observed difference in cardiovascular disease related ED visits between Above Moderate Income census tracts and Extremely Low Income census tract groups is 8.19 standard deviations **below** the null of zero difference.

Now that I have a calculated z-score, I am then able to calculate the p-value. I decided to input `lower.tail = TRUE` because I am finding the probability that the lower tail of my confidence interval is no bigger than my z score of `-8.19`.

\* In other words, I am using `lower.tail = TRUE` because we are trying to calculate the probability to the **left** of 0 .

```{r}
p_value <- pnorm(z,lower.tail = FALSE)
p_value >= 0.05
```

Alternatively, this hypothesis test can be executed using a `t.test()`

```{r}
t.test(income_water_la$cardiovascular_disease[income_water_la$ami_category == 'Extremely Low Income'], income_water_la$cardiovascular_disease[income_water_la$ami_category == 'Above Moderate Income'])
```

## Results

## Conclusion

## References
